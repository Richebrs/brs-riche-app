
<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Dashboard - BRS RICHE</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<style>
body {
  font-family:'Segoe UI',sans-serif; margin:0; padding:0;
  background:#f4f7fb; color:#333; user-select:none; display:none; overflow-x:hidden;
}
header {
  background:#0d47a1; color:#fff; padding:20px; text-align:center; position:relative;
}
header h1 { margin:0; font-size:1.6em; }
header .user-info { margin-top:8px; font-size:0.95em; opacity:0.9; }
.lang-dropdown { position:absolute; top:20px; right:20px; }
.lang-btn { cursor:pointer; font-size:1.3em; }
.lang-menu { display:none; position:absolute; top:120%; right:0; background:#fff; color:#333; border-radius:8px; box-shadow:0 4px 10px rgba(0,0,0,0.2); min-width:120px; z-index:10; }
.lang-menu div { padding:8px 12px; cursor:pointer; }
.lang-menu div:hover { background:#f0f0f0; }
.balance-card { background:#fff; margin:20px; padding:20px; border-radius:16px; box-shadow:0 6px 16px rgba(0,0,0,0.15); display:flex; justify-content:space-between; gap:20px; }
.balance-box { flex:1; text-align:center; }
.balance-box h3 { margin:0; font-size:1em; color:#0d47a1; }
.balance-box p { margin:8px 0 0; font-size:1.4em; font-weight:bold; }
.history-btn { display:block; margin:10px 20px; padding:15px; text-align:center; font-size:1.1em; font-weight:bold; color:#fff; background:#ff9800; border-radius:12px; text-decoration:none; box-shadow:0 4px 12px rgba(0,0,0,0.2); transition:background 0.2s; }
.history-btn:hover { background:#e68900; }
.menu { display:grid; grid-template-columns:repeat(auto-fit,minmax(100px,1fr)); gap:15px; margin:20px; }
.menu a { background:#ffcc00; color:#0d47a1; border-radius:14px; text-align:center; font-weight:bold; text-decoration:none; padding:20px 10px; box-shadow:0 6px 14px rgba(0,0,0,0.15); transition:transform 0.2s, background 0.2s; }
.menu a i { display:block; font-size:2em; margin-bottom:8px; }
.menu a:hover { transform:translateY(-4px); background:#e6b800; }
.presentation-btn { display:block; margin:20px auto; padding:15px 25px; background:#0d47a1; color:#fff; font-size:1.2em; font-weight:bold; border:none; border-radius:14px; cursor:pointer; text-align:center; text-decoration:none; box-shadow:0 4px 12px rgba(0,0,0,0.2); }
.presentation-btn:hover { background:#08306b; }
@media(max-width:768px){ .balance-card { flex-direction:column; text-align:center; } }
</style>
</head>

<body>
<header>
  <h1 id="title">üíé Dashboard BRS RICHE</h1>
  <div class="user-info" id="user-info"></div>
  <div class="lang-dropdown">
    <span class="lang-btn">üåê</span>
    <div class="lang-menu" id="lang-menu">
      <div data-lang="fr">üá´üá∑ Fran√ßais</div>
      <div data-lang="en">üá¨üáß English</div>
      <div data-lang="es">üá™üá∏ Espa√±ol</div>
    </div>
  </div>
</header>

<div class="balance-card">
  <div class="balance-box"><h3 id="lbl-disponible">Disponible</h3><p id="balance-available">$0.00</p></div>
  <div class="balance-box"><h3 id="lbl-retire">Retir√©</h3><p id="balance-withdrawn">$0.00</p></div>
  <div class="balance-box"><h3 id="lbl-total">Total</h3><p id="balance-total">$0.00</p></div>
</div>

<a href="history.html" class="history-btn" id="btn-history"><i class="fas fa-history"></i> Mes Historiques</a>

<div class="menu" id="standard-menu">
  <a href="deposit.html"><i class="fas fa-wallet"></i><span id="menu-deposit">D√©p√¥t</span></a>
  <a href="withdraw.html"><i class="fas fa-hand-holding-dollar"></i><span id="menu-withdraw">Retrait</span></a>
  <a href="referral.html"><i class="fas fa-users"></i><span id="menu-referral">Parrainage</span></a>
  <a href="hotels.html"><i class="fas fa-hotel"></i><span id="menu-hotels">Hotels</span></a>
  <a href="residences.html"><i class="fas fa-building"></i><span id="menu-residences">R√©sidences</span></a>
  <a href="my-hotels.html"><i class="fas fa-home"></i><span id="menu-my-hotels">Mes Hotels</span></a>
  <a href="my-residences.html"><i class="fas fa-door-closed"></i><span id="menu-my-residences">Mes Residences</span></a>
  <a href="profile.html"><i class="fas fa-user"></i><span id="menu-profile">Profil</span></a>
</div>

<div class="menu" id="admin-menu" style="display:none;">
  <a href="admin-users.html"><i class="fas fa-users-cog"></i><span>Gestion Utilisateurs</span></a>
  <a href="admin-deposits.html"><i class="fas fa-wallet"></i><span>Gestion D√©p√¥ts</span></a>
  <a href="admin-withdraws.html"><i class="fas fa-hand-holding-dollar"></i><span>Gestion Retraits</span></a>
  <a href="admin-reports.html"><i class="fas fa-file-alt"></i><span>Rapports</span></a>
</div>

<a href="presentation.html" class="presentation-btn">üìñ Pr√©sentation</a>

<script>
document.addEventListener("copy", e=>e.preventDefault());
document.addEventListener("cut", e=>e.preventDefault());
document.addEventListener("contextmenu", e=>e.preventDefault());

const firebaseConfig = {
  apiKey: "AIzaSyCxna2jjk_5BKXnsCmJmwFsM388DeFUcNQ",
  authDomain: "brs-riche-2.firebaseapp.com",
  projectId: "brs-riche-2",
  storageBucket: "brs-riche-2.appspot.com",
  messagingSenderId: "313874599780",
  appId: "1:313874599780:web:xxxxxx"
};
firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.firestore();

const translations = {
  fr: { title:"üíé Dashboard BRS RICHE", disponible:"Disponible", retire:"Retir√©", total:"Total", history:"üìú Mes Historiques", deposit:"D√©p√¥t", withdraw:"Retrait", referral:"Parrainage", hotels:"Hotels", residences:"R√©sidences", myHotels:"Mes Hotels", myResidences:"Mes R√©sidences", profile:"Profil", hello:"Bonjour" },
  en: { title:"üíé BRS Riche Dashboard", disponible:"Available", retire:"Withdrawn", total:"Total", history:"üìú My History", deposit:"Deposit", withdraw:"Withdraw", referral:"Referral", hotels:"Hotels", residences:"Residences", myHotels:"My Hotels", myResidences:"My Residences", profile:"Profile", hello:"Hello" },
  es: { title:"üíé Panel BRS Riche", disponible:"Disponible", retire:"Retirado", total:"Total", history:"üìú Mi Historial", deposit:"Dep√≥sito", withdraw:"Retiro", referral:"Referidos", hotels:"Hoteles", residences:"Residencias", myHotels:"Mis Hoteles", myResidences:"Mis Residencias", profile:"Perfil", hello:"Hola" }
};

function setLang(lang, userName=""){
  localStorage.setItem("lang", lang);
  const t = translations[lang];
  document.getElementById("title").innerText = t.title;
  document.getElementById("lbl-disponible").innerText = t.disponible;
  document.getElementById("lbl-retire").innerText = t.retire;
  document.getElementById("lbl-total").innerText = t.total;
  document.getElementById("btn-history").innerText = t.history;
  document.getElementById("menu-deposit").innerText = t.deposit;
  document.getElementById("menu-withdraw").innerText = t.withdraw;
  document.getElementById("menu-referral").innerText = t.referral;
  document.getElementById("menu-hotels").innerText = t.hotels;
  document.getElementById("menu-residences").innerText = t.residences;
  document.getElementById("menu-my-hotels").innerText = t.myHotels;
  document.getElementById("menu-my-residences").innerText = t.myResidences;
  document.getElementById("menu-profile").innerText = t.profile;
  if(userName){
    document.getElementById("user-info").innerText = `${t.hello}, ${userName}`;
  }
}

const langBtn = document.querySelector(".lang-btn");
const langMenu = document.getElementById("lang-menu");
langBtn.addEventListener("click", ()=> { langMenu.style.display = langMenu.style.display==="block" ? "none" : "block"; });
langMenu.querySelectorAll("div").forEach(el=>{ el.addEventListener("click", ()=>{ const lang = el.dataset.lang; setLang(lang, currentUserName); langMenu.style.display="none"; }); });

let currentUserName="";
auth.onAuthStateChanged(user=>{
  if(user){
    document.body.style.display="block";
    currentUserName = user.displayName || user.email.split('@')[0];
    const savedLang = localStorage.getItem("lang") || "fr";
    setLang(savedLang, currentUserName);

    const userRef = db.collection("users").doc(user.uid);
    userRef.onSnapshot(async doc=>{
      if(doc.exists){
        const data = doc.data();
        const wallet = data.wallet || {};

        const available = wallet.balance ?? 0;
        const withdrawn = wallet.totalWithdrawn ?? 0;
        const total = available + withdrawn;

        // Mettre √† jour Firestore si n√©cessaire
        if(wallet.totalGains !== total){
          await userRef.update({ "wallet.totalGains": total });
        }

        // Affichage en temps r√©el
        document.getElementById("balance-available").innerText = `$${available.toFixed(2)}`;
        document.getElementById("balance-withdrawn").innerText = `$${withdrawn.toFixed(2)}`;
        document.getElementById("balance-total").innerText = `$${total.toFixed(2)}`;
       
        // Menu admin visible uniquement si role = "admin"
if(data.role && data.role.toLowerCase() === "admin"){
  document.getElementById("admin-menu").style.display = "grid";
}
      }
    });
  } else {
    window.location.href="login.html";
  }
});
</script>

</body>
</html>

  
