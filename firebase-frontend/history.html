<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Historique - BRS Riche</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body {font-family: Arial, sans-serif; margin:0; padding:0; background:#f4f4f4;}
header {background:#222; color:#fff; padding:12px 16px; text-align:center; position:relative;}
header h1 {margin:0; font-size:18px;}
.back-btn {position:absolute; left:12px; top:50%; transform:translateY(-50%); color:#fff; text-decoration:none; font-weight:600;}
.container {padding:20px; max-width:480px; margin:0 auto;}
.activity {background:#fff; margin-bottom:12px; padding:14px; border-radius:8px; box-shadow:0 2px 6px rgba(0,0,0,0.1);}
.activity strong {display:block; margin-bottom:6px; font-size:15px;}
.activity span {display:block; font-size:14px; margin-bottom:2px;}
.date {color:gray; font-size:13px;}
.status-ok {color:#2e7d32; font-weight:700;}
.status-pending {color:#b8860b; font-weight:700;}
.status-refused {color:#e53935; font-weight:700;}
.no-data {text-align:center; color:#777; padding:12px;}
</style>
</head>
<body>

<header>
  <a href="dashboard.html" class="back-btn">‚Üê Retour</a>
  <h1>üìú Historique des d√©p√¥ts</h1>
</header>

<div class="container" id="activity-list">
  <p class="no-data">Chargement...</p>
</div>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyCxna2jjk_5BKXnsCmJmwFsM388DeFUcNQ",
  authDomain: "brs-riche-2.firebaseapp.com",
  projectId: "brs-riche-2",
  storageBucket: "brs-riche-2.appspot.com",
  messagingSenderId: "313874599780",
  appId: "1:313874599780:web:xxxxxx"
};
firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.firestore();

const activityList = document.getElementById("activity-list");
let currentUserId = null;

// Render historique
function renderActivities(docs){
  activityList.innerHTML = '';
  if(docs.length===0){
    activityList.innerHTML = '<p class="no-data">Aucun d√©p√¥t trouv√©.</p>';
    return;
  }

  docs.forEach(doc=>{
    const data = doc.data();
    const div = document.createElement('div');
    div.className='activity';

    const statusLower = (data.status||'').toLowerCase();
    const statusClass = statusLower==='en attente'?'status-pending':statusLower==='succ√®s'?'status-ok':statusLower==='annul√©'?'status-refused':'status-pending';
    const created = data.createdAt?.toDate ? data.createdAt.toDate().toLocaleString() : '-';

    div.innerHTML=`
      <strong>üíµ D√©p√¥t #${doc.id}</strong>
      <span>Montant : $${data.amount || '-'}</span>
      <span>R√©seau : ${data.network || '-'}</span>
      <span class="${statusClass}">Statut : ${data.status || '-'}</span>
      <span class="date">Date : ${created}</span>
    `;
    activityList.appendChild(div);
  });
}

// Charger d√©p√¥ts
function loadDeposits(){
  if(!currentUserId) return;
  db.collection('deposits')
    .where('userId','==',currentUserId)
    .orderBy('createdAt','desc')
    .get()
    .then(snapshot=>{
      renderActivities(snapshot.docs);
    })
    .catch(console.error);
}

// Auth
auth.onAuthStateChanged(user=>{
  if(!user){ window.location.href='login.html'; return; }
  currentUserId = user.uid;
  loadDeposits();
});
</script>

</body>
</html>
