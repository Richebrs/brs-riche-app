<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Mes Historiques - BRS RICHE</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
<style>
body {
  font-family:'Segoe UI',sans-serif; margin:0; padding:0; background:#f4f7fb; color:#333; display:none;
}
header {
  background:#0d47a1; color:#fff; padding:15px 20px; display:flex; align-items:center; justify-content:space-between;
  position:fixed; top:0; left:0; right:0; z-index:10;
}
header h1 { margin:0; font-size:1.5em; }
header .user-info { font-size:0.9em; opacity:0.9; }
.back-btn { color:#fff; font-size:1.2em; cursor:pointer; }
.lang-dropdown { position:relative; }
.lang-btn { cursor:pointer; font-size:1.2em; margin-left:15px; }
.lang-menu { display:none; position:absolute; top:120%; right:0; background:#fff; color:#333; border-radius:8px; box-shadow:0 4px 10px rgba(0,0,0,0.2); min-width:120px; z-index:10; }
.lang-menu div { padding:8px 12px; cursor:pointer; }
.lang-menu div:hover { background:#f0f0f0; }
.section { margin:80px 20px 20px; background:#fff; border-radius:12px; padding:15px; box-shadow:0 4px 12px rgba(0,0,0,0.1); }
.section h2 { margin-top:0; color:#0d47a1; }
.record { display:flex; justify-content:space-between; padding:8px 0; border-bottom:1px solid #eee; font-size:0.95em; }
.no-data { text-align:center; color:#888; padding:15px; }
</style>
</head>
<body>
<header>
  <span class="back-btn" id="back-btn"><i class="fas fa-arrow-left"></i> Retour</span>
  <h1 id="title">Mes Historiques</h1>
  <div class="lang-dropdown">
    <span class="lang-btn">üåê</span>
    <div class="lang-menu" id="lang-menu">
      <div data-lang="fr">üá´üá∑ Fran√ßais</div>
      <div data-lang="en">üá¨üáß English</div>
      <div data-lang="es">üá™üá∏ Espa√±ol</div>
    </div>
  </div>
</header>

<div class="section" id="transactions-section">
  <h2 id="lbl-transactions">Transactions</h2>
  <div id="transactions-list" class="list"></div>
</div>

<div class="section" id="referrals-section">
  <h2 id="lbl-referrals">Parrainages</h2>
  <div id="referrals-list" class="list"></div>
</div>

<div class="section" id="hotels-section">
  <h2 id="lbl-hotels">H√¥tels</h2>
  <div id="hotels-list" class="list"></div>
</div>

<div class="section" id="residences-section">
  <h2 id="lbl-residences">R√©sidences</h2>
  <div id="residences-list" class="list"></div>
</div>

<script>
// Firebase Config
const firebaseConfig = {
  apiKey: "AIzaSyCxna2jjk_5BKXnsCmJmwFsM388DeFUcNQ",
  authDomain: "brs-riche-2.firebaseapp.com",
  projectId: "brs-riche-2",
  storageBucket: "brs-riche-2.appspot.com",
  messagingSenderId: "313874599780",
  appId: "1:313874599780:web:xxxxxx"
};
firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.firestore();

// Langues
const translations = {
  fr: { title:"Mes Historiques", transactions:"Transactions", referrals:"Parrainages", hotels:"H√¥tels", residences:"R√©sidences", noData:"Aucune donn√©e disponible" },
  en: { title:"My History", transactions:"Transactions", referrals:"Referrals", hotels:"Hotels", residences:"Residences", noData:"No data available" },
  es: { title:"Mi Historial", transactions:"Transacciones", referrals:"Referidos", hotels:"Hoteles", residences:"Residencias", noData:"No hay datos disponibles" }
};

let currentUserName = "";
function setLang(lang) {
  localStorage.setItem("lang", lang);
  const t = translations[lang];
  document.getElementById("title").innerText = t.title;
  document.getElementById("lbl-transactions").innerText = t.transactions;
  document.getElementById("lbl-referrals").innerText = t.referrals;
  document.getElementById("lbl-hotels").innerText = t.hotels;
  document.getElementById("lbl-residences").innerText = t.residences;
  document.querySelectorAll(".no-data").forEach(el=>el.innerText=t.noData);
}

// Langues menu
const langBtn = document.querySelector(".lang-btn");
const langMenu = document.getElementById("lang-menu");
langBtn.addEventListener("click", ()=>{ langMenu.style.display = langMenu.style.display==="block" ? "none":"block"; });
langMenu.querySelectorAll("div").forEach(el=>{
  el.addEventListener("click", ()=>{
    setLang(el.dataset.lang);
    langMenu.style.display="none";
  });
});

// Bouton retour
document.getElementById("back-btn").addEventListener("click", ()=>{ window.location.href="dashboard.html"; });

// Auth et Firestore
auth.onAuthStateChanged(user=>{
  if(user){
    document.body.style.display="block";
    currentUserName = user.displayName || user.email.split('@')[0];
    const savedLang = localStorage.getItem("lang") || "fr";
    setLang(savedLang);

    // Transactions
    db.collection("transactions").where("userId","==",user.uid).orderBy("createdAt","desc")
    .onSnapshot(snapshot=>{
      const list = document.getElementById("transactions-list");
      list.innerHTML="";
      if(snapshot.empty){ list.innerHTML=`<div class="no-data">${translations[savedLang].noData}</div>`; return; }
      snapshot.forEach(doc=>{
        const d = doc.data();
        const date = new Date(d.createdAt.seconds*1000).toLocaleString();
        list.innerHTML += `<div class="record">${d.type}: $${d.amount.toFixed(2)} <span>${date}</span></div>`;
      });
    });

    // Parrainages
    db.collection("referrals").where("userId","==",user.uid).orderBy("createdAt","desc")
    .onSnapshot(snapshot=>{
      const list = document.getElementById("referrals-list");
      list.innerHTML="";
      if(snapshot.empty){ list.innerHTML=`<div class="no-data">${translations[savedLang].noData}</div>`; return; }
      snapshot.forEach(doc=>{
        const d = doc.data();
        const date = new Date(d.createdAt.seconds*1000).toLocaleString();
        list.innerHTML += `<div class="record">Niveau ${d.level} <span>${date}</span></div>`;
      });
    });

    // H√¥tels
    db.collection("hotels").where("userId","==",user.uid).orderBy("createdAt","desc")
    .onSnapshot(snapshot=>{
      const list = document.getElementById("hotels-list");
      list.innerHTML="";
      if(snapshot.empty){ list.innerHTML=`<div class="no-data">${translations[savedLang].noData}</div>`; return; }
      snapshot.forEach(doc=>{
        const d = doc.data();
        const date = new Date(d.createdAt.seconds*1000).toLocaleString();
        const action = d.action || "Ajout√©";
        list.innerHTML += `<div class="record">${d.name} (${action}) <span>${date}</span></div>`;
      });
    });

    // R√©sidences
    db.collection("residences").where("userId","==",user.uid).orderBy("createdAt","desc")
    .onSnapshot(snapshot=>{
      const list = document.getElementById("residences-list");
      list.innerHTML="";
      if(snapshot.empty){ list.innerHTML=`<div class="no-data">${translations[savedLang].noData}</div>`; return; }
      snapshot.forEach(doc=>{
        const d = doc.data();
        const date = new Date(d.createdAt.seconds*1000).toLocaleString();
        const action = d.action || "Ajout√©";
        list.innerHTML += `<div class="record">${d.name} (${action}) <span>${date}</span></div>`;
      });
    });

  }else{
    window.location.href="login.html";
  }
});
</script>
</body>
  </html>
  
