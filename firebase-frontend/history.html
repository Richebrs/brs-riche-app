<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Historique G√©n√©ral - BRS Riche</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body {font-family: Arial, sans-serif; margin:0; padding:0; background:#f4f4f4;}
header {background:#222; color:#fff; padding:12px 16px; text-align:center; position:relative;}
header h1 {margin:0; font-size:18px;}
.back-btn {position:absolute; left:12px; top:50%; transform:translateY(-50%); color:#fff; text-decoration:none; font-weight:600;}
.container {padding:15px; max-width:480px; margin:0 auto;}
.activity {background:#fff; margin-bottom:10px; padding:12px; border-radius:8px; box-shadow:0 1px 4px rgba(0,0,0,0.08); font-size:14px; word-wrap:break-word;}
.activity strong {display:block; margin-bottom:4px; font-size:15px;}
.activity span {display:block; margin-bottom:2px; font-size:13px; color:#555;}
.status-ok {color:#2e7d32; font-weight:700;}
.status-pending {color:#b8860b; font-weight:700;}
.status-refused {color:#e53935; font-weight:700;}
.type-label {font-size:12px; font-weight:600; color:#0d47a1; margin-bottom:4px;}
.no-data {text-align:center; color:#777; padding:12px;}
@media (max-width:520px){
  .activity {font-size:13px; padding:10px;}
  .activity strong {font-size:14px;}
  .activity span {font-size:12px;}
}
</style>
</head>
<body>

<header>
  <a href="dashboard.html" class="back-btn">‚Üê Retour</a>
  <h1>üìú Historique G√©n√©ral</h1>
</header>

<div class="container" id="activity-list">
  <p class="no-data">Chargement...</p>
</div>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyCxna2jjk_5BKXnsCmJmwFsM388DeFUcNQ",
  authDomain: "brs-riche-2.firebaseapp.com",
  projectId: "brs-riche-2",
  storageBucket: "brs-riche-2.appspot.com",
  messagingSenderId: "313874599780",
  appId: "1:313874599780:web:xxxxxx"
};
firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.firestore();

const activityList = document.getElementById("activity-list");
let currentUserId = null;

// Fonction pour afficher toutes les activit√©s
function renderActivities(docs){
  activityList.innerHTML = '';
  if(docs.length===0){
    activityList.innerHTML = '<p class="no-data">Aucune activit√© trouv√©e.</p>';
    return;
  }

  docs.forEach(doc=>{
    const data = doc.data();
    const div = document.createElement('div');
    div.className='activity';

    const created = data.createdAt?.toDate ? data.createdAt.toDate().toLocaleString() : '-';
    let statusClass = 'status-pending';

    // D√©finir couleur statut si applicable
    if(data.status){
      const s = data.status.toLowerCase();
      if(s==='succ√®s' || s==='valid√©') statusClass='status-ok';
      else if(s==='annul√©' || s==='refus√©') statusClass='status-refused';
    }

    // Choisir type et texte en fonction de l‚Äô√©v√©nement
    let typeLabel = '';
    let contentHtml = '';
    switch(data.type){
      case 'deposit':
        typeLabel = 'üí∞ D√©p√¥t';
        contentHtml = `
          <span>Montant : $${data.amount}</span>
          <span>R√©seau : ${data.network}</span>
          <span class="${statusClass}">Statut : ${data.status || '-'}</span>
        `;
        break;
      case 'withdraw':
        typeLabel = 'üè¶ Retrait';
        contentHtml = `
          <span>Montant : $${data.amount}</span>
          <span class="${statusClass}">Statut : ${data.status || '-'}</span>
        `;
        break;
      case 'hotel':
        typeLabel = 'üè® R√©servation H√¥tel/R√©sidence';
        contentHtml = `
          <span>Nom : ${data.hotelName || '-'}</span>
          <span>Montant : $${data.amount || '-'}</span>
        `;
        break;
      case 'referral':
        typeLabel = 'üë• Commission de parrainage';
        contentHtml = `
          <span>Parrain : ${data.referrer || '-'}</span>
          <span>Montant : $${data.amount || '-'}</span>
        `;
        break;
      case 'daily-income':
        typeLabel = 'üíµ Revenu quotidien';
        contentHtml = `
          <span>Source : ${data.source || '-'}</span>
          <span>Montant : $${data.amount || '-'}</span>
        `;
        break;
      default:
        typeLabel = '‚ÑπÔ∏è Autre';
        contentHtml = `<span>${data.description || '-'}</span>`;
    }

    div.innerHTML = `
      <div class="type-label">${typeLabel}</div>
      ${contentHtml}
      <span class="date">Date : ${created}</span>
    `;

    activityList.appendChild(div);
  });
}

// Charger toutes les activit√©s
function loadActivities(){
  if(!currentUserId) return;
  db.collection('activities') // Collection unique pour toutes les activit√©s
    .where('userId','==',currentUserId)
    .orderBy('createdAt','desc')
    .get()
    .then(snapshot=>{
      renderActivities(snapshot.docs);
    })
    .catch(console.error);
}

// Auth
auth.onAuthStateChanged(user=>{
  if(!user){ window.location.href='login.html'; return; }
  currentUserId = user.uid;
  loadActivities();
});
</script>

</body>
  </html>
  
