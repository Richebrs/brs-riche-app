<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Mes Historiques - BRS Riche</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      background: #f9f9f9;
      user-select: none; /* Anti copier-coller */
    }
    header {
      background: #007bff;
      color: white;
      padding: 15px;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }
    header h1 {
      margin: 0;
      font-size: 18px;
    }
    .back-btn {
      background: white;
      color: #007bff;
      border: none;
      padding: 6px 12px;
      border-radius: 5px;
      cursor: pointer;
      font-weight: bold;
    }
    .lang-select {
      background: white;
      color: #007bff;
      border: none;
      padding: 6px 10px;
      border-radius: 5px;
      cursor: pointer;
      font-weight: bold;
    }
    .container {
      padding: 20px;
    }
    .activity {
      background: white;
      margin: 10px auto;
      padding: 15px;
      border-radius: 8px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
      text-align: center;
      max-width: 500px;
    }
    .activity h3 {
      margin: 0;
      font-size: 16px;
      color: #007bff;
    }
    .activity p {
      margin: 5px 0 0;
      font-size: 14px;
    }
    .empty {
      text-align: center;
      margin-top: 50px;
      color: gray;
      font-style: italic;
    }
  </style>
</head>
<body>
  <header>
    <button class="back-btn" onclick="window.location.href='dashboard.html'">← <span id="backText">Retour</span></button>
    <h1 id="pageTitle">Mes Historiques</h1>
    <select class="lang-select" id="langSelect">
      <option value="fr">FR</option>
      <option value="en">EN</option>
    </select>
  </header>

  <div class="container">
    <div id="activities"></div>
  </div>

  <script>
    // ✅ Config Firebase
    const firebaseConfig = {
      apiKey: "TON_API_KEY",
      authDomain: "TON_PROJET.firebaseapp.com",
      projectId: "TON_PROJET",
      storageBucket: "TON_PROJET.appspot.com",
      messagingSenderId: "TON_ID",
      appId: "TON_APP_ID"
    };

    const app = firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();

    const activitiesDiv = document.getElementById("activities");

    // Traductions
    const translations = {
      fr: {
        title: "Mes Historiques",
        back: "Retour",
        empty: "Aucune activité trouvée",
        deposit: "Dépôt de",
        withdraw: "Retrait de",
        referral: "Parrainage",
        hotel: "Nouvel hôtel ajouté",
        residence: "Nouvelle résidence ajoutée"
      },
      en: {
        title: "My History",
        back: "Back",
        empty: "No activity found",
        deposit: "Deposit of",
        withdraw: "Withdrawal of",
        referral: "Referral",
        hotel: "New hotel added",
        residence: "New residence added"
      }
    };

    let currentLang = "fr";

    const pageTitle = document.getElementById("pageTitle");
    const backText = document.getElementById("backText");
    const langSelect = document.getElementById("langSelect");

    langSelect.addEventListener("change", () => {
      currentLang = langSelect.value;
      pageTitle.innerText = translations[currentLang].title;
      backText.innerText = translations[currentLang].back;
      renderActivities();
    });

    let activities = [];

    function renderActivities() {
      activitiesDiv.innerHTML = "";

      if (activities.length === 0) {
        activitiesDiv.innerHTML = `<p class="empty">${translations[currentLang].empty}</p>`;
        return;
      }

      activities.sort((a, b) => b.date - a.date);

      activities.forEach(act => {
        const div = document.createElement("div");
        div.classList.add("activity");
        div.innerHTML = `
          <h3>${act.type}</h3>
          <p>${act.message}</p>
          <small>${act.date.toLocaleString()}</small>
        `;
        activitiesDiv.appendChild(div);
      });
    }

    auth.onAuthStateChanged(user => {
      if (!user) {
        window.location.href = "login.html";
        return;
      }

      // Transactions
      db.collection("transactions").where("userId", "==", user.uid)
        .onSnapshot(snapshot => {
          snapshot.docChanges().forEach(change => {
            const data = change.doc.data();
            activities.push({
              type: data.type === "dépôt" ? translations[currentLang].deposit : translations[currentLang].withdraw,
              message: `${data.type === "dépôt" ? translations[currentLang].deposit : translations[currentLang].withdraw} $${data.montant}`,
              date: data.date ? data.date.toDate() : new Date()
            });
          });
          renderActivities();
        });

      // Parrainages
      db.collection("parrainages").where("userId", "==", user.uid)
        .onSnapshot(snapshot => {
          snapshot.docChanges().forEach(change => {
            const data = change.doc.data();
            activities.push({
              type: translations[currentLang].referral,
              message: `${translations[currentLang].referral} niveau ${data.niveau}`,
              date: data.date ? data.date.toDate() : new Date()
            });
          });
          renderActivities();
        });

      // Hôtels
      db.collection("hotels").where("userId", "==", user.uid)
        .onSnapshot(snapshot => {
          snapshot.docChanges().forEach(change => {
            const data = change.doc.data();
            activities.push({
              type: translations[currentLang].hotel,
              message: `${translations[currentLang].hotel}: ${data.nom}`,
              date: data.date ? data.date.toDate() : new Date()
            });
          });
          renderActivities();
        });

      // Résidences
      db.collection("residences").where("userId", "==", user.uid)
        .onSnapshot(snapshot => {
          snapshot.docChanges().forEach(change => {
            const data = change.doc.data();
            activities.push({
              type: translations[currentLang].residence,
              message: `${translations[currentLang].residence}: ${data.nom}`,
              date: data.date ? data.date.toDate() : new Date()
            });
          });
          renderActivities();
        });
    });

    // Anti copier/coller
    document.addEventListener("copy", e => e.preventDefault());
    document.addEventListener("cut", e => e.preventDefault());
    document.addEventListener("paste", e => e.preventDefault());
  </script>
</body>
  </html>
        
