<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Retrait - BRS Riche</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body { font-family: Arial, sans-serif; margin:0; padding:0; background:#f4f6f8; }
header { background:#1976d2; color:white; padding:15px; text-align:center; font-size:18px; position:relative; }
header a { position:absolute; left:12px; top:50%; transform:translateY(-50%); color:white; text-decoration:none; font-size:16px; }

.container { max-width:480px; margin:20px auto; background:white; padding:20px; border-radius:8px; box-shadow:0 2px 6px rgba(0,0,0,0.1); }
h2 { margin-top:0; font-size:18px; text-align:center; }
form label { display:block; margin:10px 0 5px; font-weight:bold; }
form input, form select { width:100%; padding:10px; border:1px solid #ccc; border-radius:6px; margin-bottom:15px; font-size:14px; }
button { width:100%; padding:12px; background:#1976d2; color:white; border:none; border-radius:6px; font-size:16px; cursor:pointer; }
button:disabled { background:gray; cursor:not-allowed; }

.message { text-align:center; margin-top:15px; font-size:14px; }
.message.success { color:green; }
.message.error { color:red; }
</style>
</head>
<body>

<header>
  <a href="dashboard.html">‚Üê Retour</a>
  üí∏ Demande de Retrait
</header>

<div class="container">
  <h2>Formulaire de retrait</h2>
  <form id="withdraw-form">
    <label for="amount">Montant ($)</label>
    <input type="number" id="amount" required min="1">

    <label for="network">R√©seau</label>
    <select id="network" required>
      <option value="">-- Choisir --</option>
      <option value="BEP20">BEP20</option>
      <option value="ERC20">ERC20</option>
      <option value="TRC20">TRC20</option>
    </select>

    <label for="address">Adresse de retrait</label>
    <input type="text" id="address" required placeholder="Votre adresse crypto">

    <button type="submit">üì§ Envoyer la demande</button>
  </form>

  <div class="message" id="message"></div>
</div>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<script>
// --- Config Firebase ---
const firebaseConfig = {
  apiKey: "AIzaSyCxna2jjk_5BKXnsCmJmwFsM388DeFUcNQ",
  authDomain: "brs-riche-2.firebaseapp.com",
  projectId: "brs-riche-2",
  storageBucket: "brs-riche-2.appspot.com",
  messagingSenderId: "313874599780",
  appId: "1:313874599780:web:xxxxxx"
};
firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.firestore();

// --- Formulaire ---
const form = document.getElementById("withdraw-form");
const messageBox = document.getElementById("message");

let currentUser = null;

// V√©rif utilisateur connect√©
auth.onAuthStateChanged(user=>{
  if(!user){ window.location.href = "login.html"; return; }
  currentUser = user;
});

// Soumission retrait
form.addEventListener("submit", async (e)=>{
  e.preventDefault();
  if(!currentUser) return;

  const amount = parseFloat(document.getElementById("amount").value);
  const network = document.getElementById("network").value;
  const address = document.getElementById("address").value;

  if(isNaN(amount) || amount <= 0){
    messageBox.textContent = "Montant invalide.";
    messageBox.className = "message error";
    return;
  }

  const withdrawal = {
    userId: currentUser.uid,
    email: currentUser.email,
    amount,
    network,
    withdrawAddress: address,
    status: "En attente",
    createdAt: firebase.firestore.FieldValue.serverTimestamp()
  };

  try {
    await db.collection("withdrawals").add(withdrawal);
    form.reset();
    messageBox.textContent = "‚úÖ Demande envoy√©e avec succ√®s. En attente de validation.";
    messageBox.className = "message success";
  } catch (err) {
    console.error(err);
    messageBox.textContent = "‚ùå Erreur lors de l'envoi.";
    messageBox.className = "message error";
  }
});
</script>

</body>
  </html>
        
