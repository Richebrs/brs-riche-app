
<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Inscription - BRS RICHE</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"/>
<style>
body { font-family: 'Segoe UI', Arial, sans-serif; margin:0; padding:0;
  background: linear-gradient(135deg,#0d47a1,#1976d2);
  display:flex; justify-content:center; align-items:center; min-height:100vh; }
#register-container { background:#fff; padding:40px 32px; border-radius:20px; box-shadow:0 8px 28px rgba(0,0,0,0.25); width:100%; max-width:400px; text-align:center; }
h1 { color:#0d47a1; margin-bottom:20px; font-size:2em; }
input[type="text"], input[type="email"], input[type="password"] { width:100%; padding:12px 14px; margin:8px 0 4px 0; border:1px solid #ccc; border-radius:10px; font-size:1em; }
input:focus { border-color:#1976d2; outline:none; }
.password-container { position:relative; }
.password-container i { position:absolute; top:12px; right:12px; cursor:pointer; color:#555; }
button { background:#ffcc00; color:#0d47a1; border:none; padding:12px 24px; border-radius:12px; font-weight:bold; cursor:pointer; width:100%; margin-top:16px; }
button:hover { background:#ffd633; }
#message { margin-top:12px; font-weight:bold; }
.success { color:green; }
.error { color:red; }
a { display:block; margin-top:12px; color:#1976d2; text-decoration:none; }
a:hover { text-decoration: underline; }
</style>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
<script>
const firebaseConfig = {
  apiKey: "AIzaSyCxna2jjk_5BKXnsCmJmwFsM388DeFUcNQ",
  authDomain: "brs-riche-2.firebaseapp.com",
  projectId: "brs-riche-2"
};
firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.firestore();
</script>
</head>
<body>
<div id="register-container">
  <h2>üåç BRS RICHE</h2>
  <form id="register-form">
    <input type="text" id="username" placeholder="Choisissez un pseudo unique" required/>
    <input type="email" id="email" placeholder="Votre email sera utilis√© pour la connexion" required/>

    <div class="password-container">
      <input type="password" id="password" placeholder="Mot de passe (min 6 caract√®res)" required/>
      <i id="togglePassword" class="fas fa-eye"></i>
    </div>
    <div class="password-container">
      <input type="password" id="confirmPassword" placeholder="Retapez le mot de passe" required/>
      <i id="toggleConfirm" class="fas fa-eye"></i>
    </div>

    <input type="text" id="referral" placeholder="Code de parrainage (optionnel)"/>
    <button type="submit">S‚Äôinscrire</button>
  </form>
  <div id="message"></div>
  <a href="login.html">D√©j√† membre ? Connexion</a>
</div>

<script>
// --- Masquer / afficher mots de passe ---
const togglePassword = document.getElementById('togglePassword');
const toggleConfirm = document.getElementById('toggleConfirm');
togglePassword.addEventListener('click', () => {
  const pass = document.getElementById('password');
  pass.type = pass.type === 'password' ? 'text' : 'password';
  togglePassword.classList.toggle('fa-eye-slash');
});
toggleConfirm.addEventListener('click', () => {
  const pass = document.getElementById('confirmPassword');
  pass.type = pass.type === 'password' ? 'text' : 'password';
  toggleConfirm.classList.toggle('fa-eye-slash');
});

// --- Inscription ---
document.getElementById('register-form').addEventListener('submit', async (e)=>{
  e.preventDefault();
  const username = document.getElementById('username').value.trim();
  const email = document.getElementById('email').value.trim();
  const password = document.getElementById('password').value;
  const confirmPassword = document.getElementById('confirmPassword').value;
  const referralCode = document.getElementById('referral').value || null;
  const message = document.getElementById('message');

  message.textContent = '';
  message.className = '';

  if(password.length < 6){ message.textContent="‚ùå Mot de passe trop court"; message.className='error'; return; }
  if(password !== confirmPassword){ message.textContent="‚ùå Les mots de passe ne correspondent pas"; message.className='error'; return; }

  try {
    // V√©rifier si pseudo d√©j√† utilis√©
    const usernameDoc = await db.collection('usernames').doc(username).get();
    if(usernameDoc.exists){ throw new Error("Pseudo d√©j√† utilis√© !"); }

    // Cr√©er compte Firebase Auth
    const userCredential = await auth.createUserWithEmailAndPassword(email, password);
    const user = userCredential.user;

    // Ajouter dans /users
    await db.collection('users').doc(user.uid).set({
      username, email, role:"user", referralCode, createdAt: firebase.firestore.FieldValue.serverTimestamp(),
      wallet: { balance:0, totalGains:0, totalWithdrawn:0 }
    });

    // Cr√©er mapping username ‚Üí email
    await db.collection('usernames').doc(username).set({ email });

    // Cr√©er documents vides
    await db.collection('referrals').doc(user.uid).set({ level1:[], level2:[], level3:[], totalBonus:0 });
    await db.collection('hotels').doc(user.uid).set({ hotelsList:[] });
    await db.collection('residences').doc(user.uid).set({ residencesList:[] });
    await db.collection('transactions').doc(user.uid).set({ transactions:[] });

    message.textContent = "‚úÖ Inscription r√©ussie ! Redirection...";
    message.className = 'success';
    setTimeout(()=>{ window.location.href="login.html"; }, 2000);

  } catch(err){
    message.textContent = "‚ùå " + err.message;
    message.className = 'error';
  }
});
</script>
</body>
       </html>
       
