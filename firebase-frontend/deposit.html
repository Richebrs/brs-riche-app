
<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>D√©p√¥t | BRS Riche</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
<style>
body {
  font-family: Arial, sans-serif;
  margin:0; padding:0;
  background:#f4f6f8;
  text-align:center;
}
header {
  background:#1976d2; color:#fff; padding:15px; font-size:20px;
}
.container { padding:20px; }
input, select { padding:10px; margin:8px 0; border-radius:5px; border:1px solid #ccc; width:80%; max-width:400px; }
button { padding:10px 20px; margin:10px; border:none; border-radius:5px; cursor:pointer; color:#fff; }
button#btn-submit { background:#2e7d32; }
button#btn-cancel { background:#c62828; }
.address-box { background:#fff; padding:15px; border-radius:8px; margin:10px auto; display:inline-block; min-width:300px; }
.alert { color:red; font-weight:bold; margin:10px 0; }
#copyBtn { background:#1976d2; margin-left:10px; }
.fixed-contact { position:fixed; bottom:20px; right:20px; background:#0d47a1; color:#fff; padding:12px 16px; border-radius:50%; font-size:18px; cursor:pointer; text-decoration:none; }
.success-msg { color:green; font-weight:bold; margin:10px 0; }
</style>
</head>
<body>

<header id="title">üí∞ D√©p√¥t</header>

<div class="container">
  <div>
    <label for="network">Choisir le r√©seau :</label><br>
    <select id="network">
      <option value="BEP20">USDT BEP20</option>
      <option value="TRC20">USDT TRC20</option>
    </select>
  </div>

  <div class="address-box" id="addressBox">
    <span id="addressText">Adresse de d√©p√¥t</span>
    <button id="copyBtn">Copier</button>
  </div>

  <div>
    <input type="number" id="amount" placeholder="Montant √† d√©poser (min 5$)" min="5" step="0.01">
  </div>
  
  <div>
    <input type="email" id="email" placeholder="Votre email pour v√©rification" required>
  </div>

  <div>
    <input type="text" id="txHash" placeholder="Hash de la transaction / TX">
  </div>

  <p class="alert" id="alertMsg"></p>
  <p class="success-msg" id="successMsg"></p>

  <div>
    <button id="btn-submit">J'ai pay√© / Envoy√©</button>
    <button id="btn-cancel">Annuler la demande</button>
  </div>
</div>

<a href="https://t.me/adminBRS" target="_blank" class="fixed-contact">üí¨</a>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyCxna2jjk_5BKXnsCmJmwFsM388DeFUcNQ",
  authDomain: "brs-riche-2.firebaseapp.com",
  projectId: "brs-riche-2"
};
firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.firestore();

const addresses = {
  BEP20: "0x6d056b4f8b637f6a93e98206a21ab45d3ec5ace2",
  TRC20: "TXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX"
};

const addressText = document.getElementById("addressText");
const networkSelect = document.getElementById("network");
const copyBtn = document.getElementById("copyBtn");
const btnSubmit = document.getElementById("btn-submit");
const btnCancel = document.getElementById("btn-cancel");
const alertMsg = document.getElementById("alertMsg");
const successMsg = document.getElementById("successMsg");

let currentAddress = addresses.BEP20;
addressText.innerText = currentAddress;

networkSelect.addEventListener("change", () => {
  currentAddress = addresses[networkSelect.value];
  addressText.innerText = currentAddress;
});

copyBtn.addEventListener("click", () => {
  navigator.clipboard.writeText(currentAddress).then(() => {
    successMsg.innerText = "Adresse copi√©e avec succ√®s !";
    setTimeout(()=>{ successMsg.innerText = ""; }, 3000);
  });
});

auth.onAuthStateChanged(user => {
  if(!user) window.location.href = "login.html";

  btnSubmit.addEventListener("click", async () => {
    alertMsg.innerText = "";
    successMsg.innerText = "";

    const amount = parseFloat(document.getElementById("amount").value);
    const email = document.getElementById("email").value.trim();
    const txHash = document.getElementById("txHash").value.trim();

    if(amount < 5) { alertMsg.innerText = "Le montant minimum est 5$"; return; }
    if(!email) { alertMsg.innerText = "Veuillez saisir votre email"; return; }
    if(!txHash) { alertMsg.innerText = "Veuillez saisir le hash de la transaction"; return; }
    if(!currentAddress) { alertMsg.innerText = "Adresse de d√©p√¥t invalide"; return; }

    await db.collection("deposits").add({
      uid: user.uid,
      username: user.displayName || user.email.split('@')[0],
      email: email,
      amount: amount,
      network: networkSelect.value,
      txHash: txHash,
      status: "pending",
      createdAt: firebase.firestore.Timestamp.now()
    });

    successMsg.innerText = "Votre demande de d√©p√¥t a √©t√© envoy√©e. Veuillez attendre la validation.";
    document.getElementById("amount").value = "";
    document.getElementById("txHash").value = "";
    document.getElementById("email").value = "";
  });

  btnCancel.addEventListener("click", async () => {
    const snapshot = await db.collection("deposits")
      .where("uid", "==", user.uid)
      .where("status", "==", "pending")
      .orderBy("createdAt", "desc")
      .limit(1)
      .get();

    if(!snapshot.empty) {
      await snapshot.docs[0].ref.delete();
      successMsg.innerText = "Votre demande a √©t√© annul√©e.";
    } else {
      alertMsg.innerText = "Aucune demande en attente √† annuler.";
    }
  });
});
</script>

</body>
</html>

  
