
<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Dépôt | BRS Riche</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
<style>
body { font-family: Arial, sans-serif; margin:0; padding:0; background:#f4f6f8; text-align:center; }
header { background:#1976d2; color:#fff; padding:15px; font-size:20px; position:relative; }
.container { padding:20px; }
input, select { padding:10px; margin:8px 0; border-radius:5px; border:1px solid #ccc; width:80%; max-width:400px; display:block; margin-left:auto; margin-right:auto; }
button { padding:10px 20px; margin:10px; border:none; border-radius:5px; cursor:pointer; color:#fff; }
button#btn-submit { background:#2e7d32; }
button#btn-cancel { background:#c62828; }
.address-box { background:#fff; padding:15px; border-radius:8px; margin:10px auto; display:inline-block; min-width:300px; }
.alert { color:red; font-weight:bold; margin:10px 0; }
#copyBtn { background:#1976d2; margin-left:10px; }
.fixed-contact { position:fixed; bottom:20px; right:20px; background:#0d47a1; color:#fff; padding:12px 16px; border-radius:50%; font-size:18px; cursor:pointer; text-decoration:none; }
</style>
</head>
<body>

<header id="title">💰 Dépôt</header>

<div class="container">
  <div>
    <label id="label-network" for="network">Choisir le réseau :</label><br>
    <select id="network">
      <option value="BEP20">USDT BEP20</option>
      <option value="TRC20">USDT TRC20</option>
    </select>
  </div>

  <div class="address-box" id="addressBox">
    <span id="addressText">Adresse de dépôt</span>
    <button id="copyBtn">Copier</button>
  </div>

  <div>
    <input type="number" id="amount" placeholder="Montant à déposer (min 5$)" min="5" step="0.01">
  </div>
  
  <div>
    <input type="email" id="email" placeholder="Votre email pour vérification" required>
  </div>

  <div>
    <input type="text" id="txHash" placeholder="Hash de la transaction / TX">
  </div>

  <div>
    <input type="file" id="screenshot" accept="image/*">
  </div>

  <p class="alert" id="alertMsg"></p>

  <div>
    <button id="btn-submit">J'ai payé / Envoyé</button>
    <button id="btn-cancel">Annuler la demande</button>
  </div>
</div>

<a href="https://t.me/adminBRS" target="_blank" class="fixed-contact">💬</a>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyCxna2jjk_5BKXnsCmJmwFsM388DeFUcNQ",
  authDomain: "brs-riche-2.firebaseapp.com",
  projectId: "brs-riche-2"
};
firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.firestore();

const addresses = {
  BEP20: "RolandBlaise3e98206a21ab45d3ec5ace2",
  TRC20: "TXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX"
};

const translations = {
  fr: {
    title: "💰 Dépôt",
    network: "Choisir le réseau :",
    minAmount: "Le montant minimum est 5$",
    emailRequired: "Veuillez saisir votre email",
    txRequired: "Veuillez saisir le hash de la transaction",
    invalidAddress: "Adresse de dépôt invalide",
    sent: "Votre demande de dépôt a été envoyée. Veuillez attendre la validation.",
    cancelDone: "Votre demande a été annulée.",
    cancelEmpty: "Aucune demande en attente à annuler."
  },
  en: {
    title: "💰 Deposit",
    network: "Select network:",
    minAmount: "Minimum deposit is $5",
    emailRequired: "Please enter your email",
    txRequired: "Please enter the transaction hash",
    invalidAddress: "Invalid deposit address",
    sent: "Your deposit request has been sent. Please wait for validation.",
    cancelDone: "Your request has been canceled.",
    cancelEmpty: "No pending request to cancel."
  },
  es: {
    title: "💰 Depósito",
    network: "Seleccionar red:",
    minAmount: "El depósito mínimo es $5",
    emailRequired: "Por favor ingrese su correo electrónico",
    txRequired: "Por favor ingrese el hash de la transacción",
    invalidAddress: "Dirección de depósito inválida",
    sent: "Su solicitud de depósito ha sido enviada. Espere la validación.",
    cancelDone: "Su solicitud ha sido cancelada.",
    cancelEmpty: "No hay solicitudes pendientes para cancelar."
  }
};

let lang = localStorage.getItem("lang") || "fr";
function setLang() {
  const t = translations[lang];
  document.getElementById("title").innerText = t.title;
  document.getElementById("label-network").innerText = t.network;
}
setLang();

let currentAddress = addresses.BEP20;
const addressText = document.getElementById("addressText");
addressText.innerText = currentAddress;

const networkSelect = document.getElementById("network");
networkSelect.addEventListener("change", () => {
  currentAddress = addresses[networkSelect.value];
  addressText.innerText = currentAddress;
});

document.getElementById("copyBtn").addEventListener("click", () => {
  navigator.clipboard.writeText(currentAddress).then(()=>alert("Adresse copiée !"));
});

const alertMsg = document.getElementById("alertMsg");

auth.onAuthStateChanged(user => {
  if(!user) window.location.href = "login.html";

  document.getElementById("btn-submit").addEventListener("click", async () => {
    const amount = parseFloat(document.getElementById("amount").value);
    const email = document.getElementById("email").value.trim();
    const txHash = document.getElementById("txHash").value.trim();
    const screenshot = document.getElementById("screenshot").files[0];

    const t = translations[lang];

    if(amount < 5) { alertMsg.innerText = t.minAmount; return; }
    if(!email) { alertMsg.innerText = t.emailRequired; return; }
    if(!txHash) { alertMsg.innerText = t.txRequired; return; }
    if(!currentAddress) { alertMsg.innerText = t.invalidAddress; return; }

    let screenshotURL = "";
    if(screenshot) {
      const reader = new FileReader();
      reader.readAsDataURL(screenshot);
      screenshotURL = await new Promise(res => reader.onload = () => res(reader.result));
    }

    db.collection("deposits").add({
      uid: user.uid,
      username: user.displayName || user.email.split('@')[0],
      email: email,
      amount: amount,
      network: networkSelect.value,
      txHash: txHash,
      screenshotURL: screenshotURL,
      status: "pending",
      createdAt: firebase.firestore.Timestamp.now()
    }).then(() => {
      alert(t.sent);
      document.getElementById("amount").value = "";
      document.getElementById("txHash").value = "";
      document.getElementById("email").value = "";
      document.getElementById("screenshot").value = "";
      alertMsg.innerText = "";
    });
  });

  document.getElementById("btn-cancel").addEventListener("click", () => {
    const t = translations[lang];
    db.collection("deposits")
      .where("uid", "==", user.uid)
      .where("status", "==", "pending")
      .orderBy("createdAt", "desc")
      .limit(1)
      .get()
      .then(snapshot => {
        if(!snapshot.empty) {
          snapshot.docs[0].ref.delete().then(() => alert(t.cancelDone));
        } else alert(t.cancelEmpty);
      });
  });
});
</script>

</body>
  </html>
  
