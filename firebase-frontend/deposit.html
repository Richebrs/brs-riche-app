
<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <title>D√©p√¥t - BRS RICHE</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"/>

  <!-- Firebase compat (auth, firestore, storage) -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-storage-compat.js"></script>

  <style>
    :root{--primary:#0d47a1;--danger:#e53935;--ok:#2e7d32}
    *{box-sizing:border-box}
    body{
      font-family:"Segoe UI",system-ui,Arial,sans-serif;
      margin:0; background:#f4f7fb; color:#222;
      user-select:none; /* anti copy */
      display:none;
    }
    header{
      background:var(--primary); color:#fff; padding:14px 16px; position:relative;
      display:flex; align-items:center; justify-content:center;
    }
    .back-btn{ position:absolute; left:12px; top:50%; transform:translateY(-50%); color:#fff; cursor:pointer; font-weight:600; text-decoration:none }
    .lang-dropdown{ position:absolute; right:12px; top:12px; }
    .lang-btn{ background:transparent; border:none; color:#fff; cursor:pointer; font-size:18px }
    .lang-menu{ display:none; position:absolute; right:0; top:36px; background:#fff; color:#222; border-radius:8px; box-shadow:0 6px 18px rgba(0,0,0,0.15); overflow:hidden; min-width:120px; z-index:50 }
    .lang-menu div{ padding:8px 12px; cursor:pointer }
    .lang-menu div:hover{ background:#f0f0f0 }
    main{ padding:18px; max-width:980px; margin:16px auto; }

    .card{ background:#fff; padding:16px; border-radius:12px; box-shadow:0 6px 18px rgba(0,0,0,0.06); margin-bottom:16px }
    .card h2{ margin:0 0 8px; color:var(--primary) }
    label{ display:block; margin:10px 0 6px; font-weight:600 }
    input[type="number"], input[type="text"], select, input[type="file"]{
      width:100%; padding:10px; border-radius:8px; border:1px solid #dcdcdc; font-size:15px;
    }
    .address-box{
      position:relative; background:#f1f1f1; padding:12px 110px 12px 12px; border-radius:8px; font-weight:700; word-break:break-all;
    }
    .copy-btn{ position:absolute; right:10px; top:50%; transform:translateY(-50%); background:var(--primary); border:none; color:#fff; padding:8px 10px; border-radius:8px; cursor:pointer }
    .warning{ color:var(--danger); font-weight:700; margin-bottom:8px }
    .help{ background:#fff3cd; color:#856404; padding:10px; border-radius:8px; border:1px solid #ffeeba; margin-top:12px; font-size:14px }

    .btn-primary{ background:var(--primary); color:#fff; border:none; padding:12px; border-radius:8px; width:100%; font-weight:700; cursor:pointer; margin-top:12px }
    .status-ok{ color:var(--ok); font-weight:700 }
    .status-pending{ color:#b8860b; font-weight:700 }
    .history h3{ margin-top:0; color:var(--primary) }
    .history-item{ padding:12px; border-radius:8px; background:#fff; margin-bottom:10px; box-shadow:0 2px 8px rgba(0,0,0,0.06) }
    .no-data{ color:#777; text-align:center; padding:12px }

    .support{
      position:fixed; right:18px; bottom:18px; background:#0088cc; color:#fff; width:56px; height:56px; border-radius:50%;
      display:flex; align-items:center; justify-content:center; box-shadow:0 6px 18px rgba(0,0,0,0.18); text-decoration:none
    }

    .alert{
      display:none; padding:10px; border-radius:8px; margin-top:12px; font-weight:700;
    }
    .alert.error{ background:#ffebee; color:#b71c1c; border:1px solid #ffcdd2 }
    .alert.success{ background:#e8f5e9; color:#1b5e20; border:1px solid #c8e6c9 }

    @media (max-width:520px){
      .address-box{ padding-right:100px }
    }
  </style>
</head>
<body>
  <header>
    <a class="back-btn" href="dashboard.html">‚Üê Retour</a>
    <div><strong id="page-title">üí∞ D√©p√¥t</strong></div>

    <div class="lang-dropdown">
      <button class="lang-btn" id="lang-btn">üåê</button>
      <div class="lang-menu" id="lang-menu">
        <div data-lang="fr">üá´üá∑ Fran√ßais</div>
        <div data-lang="en">üá¨üáß English</div>
        <div data-lang="es">üá™üá∏ Espa√±ol</div>
      </div>
    </div>
  </header>

  <main>
    <div class="card">
      <h2 id="deposit-title">Effectuer un D√©p√¥t</h2>

      <div class="warning" id="warning-msg">‚ö†Ô∏è V√©rifiez bien le r√©seau avant d‚Äôenvoyer vos USDT ! Si vous envoyez sur un mauvais r√©seau, vos fonds seront perdus.</div>

      <label id="lbl-amount">Montant ($, min 5)</label>
      <input id="amount" type="number" min="5" placeholder="Entrez le montant (min 5$)">

      <label id="lbl-network">S√©lectionnez le r√©seau</label>
      <select id="network">
        <option value="BEP20">USDT BEP20</option>
        <option value="TRC20">USDT TRC20</option>
      </select>

      <label id="lbl-address">Adresse de d√©p√¥t</label>
      <div class="address-box" aria-live="polite" id="address-box">
        <span id="deposit-address">ADRESSE_BEP20_ICI</span>
        <button class="copy-btn" id="copyBtn" title="Copier l'adresse">Copier</button>
      </div>

      <label id="lbl-proof">Capture d‚Äô√©cran (optionnel)</label>
      <input id="screenshot" type="file" accept="image/*">

      <label id="lbl-hash">Hash / ID de transaction</label>
      <input id="tx-hash" type="text" placeholder="Collez ici le hash / ID (ex: 0x...)">

      <div class="alert error" id="alert-error"></div>
      <div class="alert success" id="alert-success"></div>

      <button class="btn-primary" id="btn-submit">‚úÖ J'ai pay√©</button>

      <div class="help" id="help-text">‚ÑπÔ∏è Si vous avez d√©j√† effectu√© le d√©p√¥t, cliquez sur "J'ai pay√©". ‚ùå Les faux d√©p√¥ts entra√Æneront la suspension d√©finitive du compte.</div>
    </div>

    <div class="card history">
      <h3 id="lbl-history">üìú Historique d√©p√¥ts</h3>
      <div id="deposit-history"> <p class="no-data">Chargement...</p> </div>
    </div>
  </main>

  <!-- Support Telegram (remplace le lien par ton lien admin) -->
  <a id="telegram-link" class="support" href="https://t.me/tonlien" target="_blank" title="Contacter le support"><i class="fab fa-telegram" style="font-size:22px"></i></a>

<script>
/* --------- CONFIGURATION : remplace ces adresses + telegram link par les tiennes -------- */
const ADDRESSES = {
  BEP20: "ADRESSE_BEP20_HERErolandetblaiseetjeanjacque6379845eyyerkufrijffiggtiohdehgjdzey",   // <-- remplace par ton adresse USDT BEP20
  TRC20: "ADRESSE_TRC20_HERtzljshdgjgliptrzhrjtlevazhrktltlrkzhzjekrlrotofksjahejrjdfnehzverbvvvvvvvvvvvv"    // <-- remplace par ton adresse USDT TRC20
};
const TELEGRAM_ADMIN_LINK = "https://t.me/tonlien"; // <-- remplace par ton lien
/* --------------------------------------------------------------------------------------- */

/* Firebase config ‚Äî remplace si besoin (gardez storageBucket si utilis√©) */
const firebaseConfig = {
  apiKey: "AIzaSyCxna2jjk_5BKXnsCmJmwFsM388DeFUcNQ",
  authDomain: "brs-riche-2.firebaseapp.com",
  projectId: "brs-riche-2",
  storageBucket: "brs-riche-2.appspot.com",
  messagingSenderId: "313874599780",
  appId: "1:313874599780:web:xxxxxx"
};
firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.firestore();
const storage = firebase.storage();

/* Traductions */
const T = {
  fr: {
    pageTitle:"üí∞ D√©p√¥t",
    deposit:"Effectuer un D√©p√¥t",
    amount:"Montant ($, min 5)",
    network:"S√©lectionnez le r√©seau",
    address:"Adresse de d√©p√¥t",
    proof:"Capture d‚Äô√©cran (optionnel)",
    hash:"Hash / ID de transaction",
    submit:"‚úÖ J'ai pay√©",
    help:"‚ÑπÔ∏è Si vous avez d√©j√† effectu√© le d√©p√¥t, cliquez sur \"J'ai pay√©\". ‚ùå Les faux d√©p√¥ts entra√Æneront la suspension d√©finitive du compte.",
    invalidAmount:"Montant invalide ‚Äî le minimum est 5$",
    missingHash:"Veuillez entrer le hash / ID de transaction",
    invalidAddress:"L'adresse de d√©p√¥t configur√©e ne semble pas valide pour ce r√©seau. Contactez l'admin.",
    invalidHash:"Hash invalide ‚Äî v√©rifiez le hash saisi",
    success:"‚úÖ Demande envoy√©e. Votre d√©p√¥t sera v√©rifi√© et valid√© sous peu.",
    noData:"Aucun d√©p√¥t trouv√©."
  },
  en: {
    pageTitle:"üí∞ Deposit",
    deposit:"Make a Deposit",
    amount:"Amount ($, min 5)",
    network:"Select network",
    address:"Deposit address",
    proof:"Screenshot (optional)",
    hash:"Transaction Hash / ID",
    submit:"‚úÖ I have paid",
    help:"‚ÑπÔ∏è If you already made the deposit, click \"I have paid\". ‚ùå Fake deposits will lead to permanent account suspension.",
    invalidAmount:"Invalid amount ‚Äî minimum is $5",
    missingHash:"Please enter the transaction hash / ID",
    invalidAddress:"Deposit address configured seems invalid for this network. Contact admin.",
    invalidHash:"Invalid hash ‚Äî check the value",
    success:"‚úÖ Request submitted. Your deposit will be reviewed and validated shortly.",
    noData:"No deposits found."
  },
  es: {
    pageTitle:"üí∞ Dep√≥sito",
    deposit:"Hacer un Dep√≥sito",
    amount:"Monto ($, m√≠n 5)",
    network:"Seleccione la red",
    address:"Direcci√≥n de dep√≥sito",
    proof:"Captura (opcional)",
    hash:"Hash / ID de transacci√≥n",
    submit:"‚úÖ He pagado",
    help:"‚ÑπÔ∏è Si ya realiz√≥ el dep√≥sito, haga clic en \"He pagado\". ‚ùå Los dep√≥sitos falsos resultar√°n en suspensi√≥n permanente de la cuenta.",
    invalidAmount:"Monto inv√°lido ‚Äî el m√≠nimo es 5$",
    missingHash:"Por favor, ingrese el hash / ID de la transacci√≥n",
    invalidAddress:"La direcci√≥n configurada parece inv√°lida para esta red. Contacte al admin.",
    invalidHash:"Hash inv√°lido ‚Äî verifique el valor",
    success:"‚úÖ Solicitud enviada. Su dep√≥sito ser√° revisado y validado en breve.",
    noData:"No se encontraron dep√≥sitos."
  }
};

/* √©l√©ments DOM */
const el = {
  body: document.body,
  langBtn: document.getElementById('lang-btn'),
  langMenu: document.getElementById('lang-menu'),
  pageTitle: document.getElementById('page-title'),
  depositTitle: document.getElementById('deposit-title'),
  lblAmount: document.getElementById('lbl-amount'),
  lblNetwork: document.getElementById('lbl-network'),
  lblAddress: document.getElementById('lbl-address'),
  lblProof: document.getElementById('lbl-proof'),
  lblHash: document.getElementById('lbl-hash'),
  amount: document.getElementById('amount'),
  network: document.getElementById('network'),
  depositAddress: document.getElementById('deposit-address'),
  copyBtn: document.getElementById('copyBtn'),
  screenshot: document.getElementById('screenshot'),
  txHash: document.getElementById('tx-hash'),
  btnSubmit: document.getElementById('btn-submit'),
  helpText: document.getElementById('help-text'),
  confirmAlert: document.getElementById('alert-success'),
  errorAlert: document.getElementById('alert-error'),
  depositHistory: document.getElementById('deposit-history'),
  warningMsg: document.getElementById('warning-msg'),
  telegram: document.getElementById('telegram-link')
};

/* gestion langue */
let LANG = localStorage.getItem('lang') || 'fr';
function openLangMenu(){ el.langMenu.style.display = el.langMenu.style.display === 'block' ? 'none' : 'block'; }
el.langBtn.addEventListener('click', openLangMenu);
el.langMenu.querySelectorAll('div').forEach(d=>{
  d.addEventListener('click', ()=>{ LANG = d.dataset.lang; localStorage.setItem('lang', LANG); applyTranslations(); el.langMenu.style.display='none'; });
});

function applyTranslations(){
  const t = T[LANG] || T.fr;
  el.pageTitle.innerText = t.pageTitle;
  el.depositTitle.innerText = t.deposit;
  el.lblAmount.innerText = t.amount;
  el.lblNetwork.innerText = t.network;
  el.lblAddress.innerText = t.address;
  document.getElementById('lbl-proof').innerText = t.proof;
  el.lblHash.innerText = t.hash;
  el.btnSubmit.innerText = t.submit;
  el.helpText.innerText = t.help;
  el.depositHistory.previousSibling && (/* keep header */ 0);
  // update alerts if visible
}

/* update adresse selon r√©seau */
function updateAddressDisplay(){
  const net = el.network.value;
  const addr = ADDRESSES[net] || "ADRESSE_NON_CONFIGUR√âE";
  el.depositAddress.innerText = addr;
}

/* copier adresse */
el.copyBtn.addEventListener('click', async ()=>{
  const text = el.depositAddress.innerText.trim();
  try{
    await navigator.clipboard.writeText(text);
    showSuccess((T[LANG] || T.fr).success.replace('‚úÖ ', 'Adresse copi√©e ‚Äî '));
  }catch(e){
    showError("Impossible de copier (autorisation).");
  }
});

/* messages */
function showError(msg){
  el.errorAlert.innerText = msg; el.errorAlert.style.display='block'; el.confirmAlert.style.display='none';
  setTimeout(()=>{ el.errorAlert.style.display='none' }, 8000);
}
function showSuccess(msg){
  el.confirmAlert.innerText = msg; el.confirmAlert.style.display='block'; el.errorAlert.style.display='none';
  setTimeout(()=>{ el.confirmAlert.style.display='none' }, 8000);
}

/* validation d'adresse / hash */
function isValidAddressForNetwork(addr, net){
  if(!addr) return false;
  if(net === 'BEP20'){
    // ETH/BSC address : 0x + 40 hex
    return /^0x[a-fA-F0-9]{40}$/.test(addr);
  } else if(net === 'TRC20'){
    // TRON typical Base58 starting with T and ~34 chars (simple check)
    return /^T[a-zA-Z0-9]{33,33}$/.test(addr);
  }
  return false;
}
function isLikelyTxHash(hash){
  if(!hash) return false;
  return /^0x?[a-fA-F0-9]{64}$/.test(hash) || /^[a-fA-F0-9]{64}$/.test(hash);
}

/* envoi */
let currentUserId = null;
el.btnSubmit.addEventListener('click', sendDeposit);

async function sendDeposit(){
  const t = T[LANG] || T.fr;
  const amount = parseFloat(el.amount.value);
  const net = el.network.value;
  const txHash = el.txHash.value?.trim();
  const addr = ADDRESSES[net];

  // validations
  if(isNaN(amount) || amount < 5){ showError(t.invalidAmount); return; }
  if(!txHash){ showError(t.missingHash); return; }
  if(!isValidAddressForNetwork(addr, net)){ showError(t.invalidAddress); return; }
  if(!isLikelyTxHash(txHash)){ showError(t.invalidHash); return; }

  // upload screenshot si fourni
  let proofUrl = null;
  const file = el.screenshot.files[0];
  if(file){
    const path = `deposits/${currentUserId}/${Date.now()}_${file.name}`;
    const ref = storage.ref().child(path);
    try{
      const snap = await ref.put(file);
      proofUrl = await snap.ref.getDownloadURL();
    }catch(err){
      console.error("Upload error", err);
      showError("Erreur upload image. R√©essayez.");
      return;
    }
  }

  // √©criture Firestore
  try{
    await db.collection('deposits').add({
      userId: currentUserId,
      amount: amount,
      network: net,
      depositAddress: addr,
      txHash: txHash,
      proofUrl: proofUrl || null,
      status: "En attente",
      createdAt: firebase.firestore.FieldValue.serverTimestamp()
    });
    showSuccess(t.success);
    el.amount.value = '';
    el.txHash.value = '';
    el.screenshot.value = '';
    // on laisse l'admin notifier via le bouton telegram (icone) si besoin
  }catch(err){
    console.error(err);
    showError("Erreur serveur. R√©essayez.");
  }
}

/* historique temps r√©el */
function renderHistorySnapshot(snap){
  const t = T[LANG] || T.fr;
  const container = el.depositHistory;
  container.innerHTML = '';
  if(snap.empty){
    container.innerHTML = `<div class="no-data">${t.noData}</div>`;
    return;
  }
  snap.forEach(doc=>{
    const d = doc.data();
    const created = d.createdAt?.toDate ? d.createdAt.toDate().toLocaleString() : "";
    const item = document.createElement('div');
    item.className = 'history-item';
    const statusClass = (d.status||'').toLowerCase().includes('en attente') || (d.status||'').toLowerCase().includes('pending') ? 'status-pending' : (d.status||'').toLowerCase().includes('valide') || (d.status||'').toLowerCase().includes('approved') ? 'status-ok' : '';
    item.innerHTML = `
      <div><strong>Montant:</strong> $${d.amount}</div>
      <div><strong>R√©seau:</strong> ${d.network}</div>
      <div><strong>Adresse:</strong> ${d.depositAddress || '-'}</div>
      <div><strong>Hash:</strong> ${d.txHash || '-'}</div>
      <div><strong>Status:</strong> <span class="${statusClass}">${d.status}</span></div>
      <div><small>${created}</small></div>
      ${d.proofUrl ? `<div style="margin-top:8px"><a href="${d.proofUrl}" target="_blank">Voir preuve</a></div>` : ''}
    `;
    container.appendChild(item);
  });
}

/* auth + initialisation */
auth.onAuthStateChanged(user=>{
  if(!user){ window.location.href = 'login.html'; return; }
  currentUserId = user.uid;
  el.body.style.display = 'block';
  // affichage adresse initiale
  updateAddressDisplay();
  // apply translations
  applyTranslations();
  // set telegram link
  document.getElementById('telegram-link').href = TELEGRAM_ADMIN_LINK;

  // history listener
  db.collection('deposits').where('userId','==',currentUserId).orderBy('createdAt','desc')
    .onSnapshot(snap => { renderHistorySnapshot(snap) });

});

/* events */
el.network.addEventListener('change', updateAddressDisplay);

/* disable right click / copy / cut / paste */
document.addEventListener('copy', e => e.preventDefault());
document.addEventListener('cut', e => e.preventDefault());
document.addEventListener('contextmenu', e => e.preventDefault());
document.addEventListener('paste', e => e.preventDefault());

/* initial translations & address */
(function init(){
  // ensure deposit address shown according to stored lang & network
  updateAddressDisplay();
  applyTranslations();
})();
</script>
</body>
</html>

  
