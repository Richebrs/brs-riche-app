<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>BRS Riche - Admin Retraits</title>
<style>
  body { font-family: Arial, sans-serif; background: #f0f2f5; margin: 0; padding: 20px; }
  h2 { text-align: center; color: #333; }
  table { width: 100%; border-collapse: collapse; margin-top: 20px; }
  th, td { padding: 12px; border: 1px solid #ccc; text-align: center; }
  th { background: #4caf50; color: #fff; }
  tr:nth-child(even) { background: #f9f9f9; }
  button { padding: 6px 12px; border-radius: 6px; border: none; cursor: pointer; margin: 2px; }
  .approve { background: #4caf50; color: #fff; }
  .reject { background: #f44336; color: #fff; }
  .success { color: green; font-weight: bold; margin-top: 10px; text-align: center; }
  .error { color: red; font-weight: bold; margin-top: 10px; text-align: center; }
</style>
</head>
<body>

<h2>üõ†Ô∏è Tableau de Retraits - Admin</h2>
<p id="message"></p>
<table id="withdrawTable">
  <thead>
    <tr>
      <th>Utilisateur</th>
      <th>Montant</th>
      <th>Frais</th>
      <th>Net</th>
      <th>R√©seau</th>
      <th>Adresse</th>
      <th>Statut</th>
      <th>Date</th>
      <th>Action</th>
    </tr>
  </thead>
  <tbody>
    <!-- Retraits seront ajout√©s ici -->
  </tbody>
</table>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyCxna2jjk_5BKXnsCmJmwFsM388DeFUcNQ",
  authDomain: "brs-riche-2.firebaseapp.com",
  projectId: "brs-riche-2",
  storageBucket: "brs-riche-2.appspot.com",
  messagingSenderId: "313874599780",
  appId: "1:313874599780:web:xxxxxx"
};

firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.firestore();

auth.onAuthStateChanged(async (user) => {
  if (user) {
    // V√©rifier si c'est un admin
    const userDoc = await db.collection("users").doc(user.uid).get();
    if (!userDoc.exists || userDoc.data().role !== "Admis") {
      document.getElementById("message").innerHTML = "<span class='error'>‚ö† Acc√®s refus√© : Vous n'√™tes pas admin</span>";
      return;
    }
    loadWithdrawals();
  } else {
    document.getElementById("message").innerHTML = "<span class='error'>‚ö† Veuillez vous connecter</span>";
  }
});

function loadWithdrawals() {
  db.collection("withdrawals").orderBy("createdAt", "desc").onSnapshot(snapshot => {
    const tbody = document.getElementById("withdrawTable").querySelector("tbody");
    tbody.innerHTML = "";
    snapshot.forEach(doc => {
      const data = doc.data();
      const tr = document.createElement("tr");
      tr.innerHTML = `
        <td>${data.username || ""}</td>
        <td>${data.amount.toFixed(2)}</td>
        <td>${data.fees.toFixed(2)}</td>
        <td>${data.net.toFixed(2)}</td>
        <td>${data.network}</td>
        <td>${data.wallet}</td>
        <td>${data.status}</td>
        <td>${data.createdAt ? data.createdAt.toDate().toLocaleString() : ""}</td>
        <td>
          ${data.status === "pending" ? `<button class="approve" onclick="updateStatus('${doc.id}','approved')">‚úÖ Approuver</button>
          <button class="reject" onclick="updateStatus('${doc.id}','rejected')">‚ùå Rejeter</button>` : ""}
        </td>
      `;
      tbody.appendChild(tr);
    });
  });
}

async function updateStatus(docId, status) {
  try {
    await db.collection("withdrawals").doc(docId).update({ status: status });
    document.getElementById("message").innerHTML = `<span class='success'>‚úÖ Statut mis √† jour avec succ√®s</span>`;
  } catch (err) {
    console.error(err);
    document.getElementById("message").innerHTML = `<span class='error'>‚ö† Erreur lors de la mise √† jour</span>`;
  }
}
</script>

</body>
  </html>
                   
